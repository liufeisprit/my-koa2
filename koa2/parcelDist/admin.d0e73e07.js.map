{"version":3,"sources":["views/admin/index.js"],"names":["site","moment","locale","Home","Component","constructor","props","_delete","setState","collapsed","state","_toggleLoading","status","loading","_getAllMovies","method","url","then","res","dataSource","catch","err","console","log","_deleteMovie","id","filter","item","_id","message","success","selectedKey","columns","title","dataIndex","key","render","text","record","posterKey","pubdate","map","it","i","date","format","country","meta","createdAt","fromNow","movieTypes","tags","padding","maxWidth","summary","componentDidMount","length","data"],"mappings":"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","file":"admin.d0e73e07.js","sourceRoot":"..\\src","sourcesContent":["import React, { Component } from 'react'\r\nimport { request } from '../../lib'\r\nimport Layout from '../../layouts/default'\r\nimport {message} from 'antd'\r\nimport {\r\n  Table,\r\n  Button\r\n} from 'antd'\r\nconst site = 'http://puzvb5scj.bkt.clouddn.com/'\r\nimport moment from 'moment'\r\nimport 'moment/locale/zh-cn'\r\n\r\nmoment.locale('zh-cn')\r\nexport default class Home extends Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = {\r\n      collapsed: false,\r\n      loading:false,\r\n      selectedKey: '0',\r\n      dataSource: [],\r\n      columns: [{\r\n        title: '海报',\r\n        dataIndex: 'posterKey',\r\n        key: 'posterKey',\r\n        render: (text, record) => (<img width=\"160\" src={site + record.posterKey} />)\r\n      }, {\r\n        title: '名字',\r\n        dataIndex: 'title',\r\n        key: 'title',\r\n      }, {\r\n        title: '原始名',\r\n        dataIndex: 'rawTitle',\r\n        key: 'rawTitle',\r\n      }, {\r\n        title: '上映时间',\r\n        dataIndex: 'pubdate',\r\n        key: 'pubdate',\r\n        render: (text, record) => (\r\n          record.pubdate.map((it, i) => (\r\n            <p key={i}>{moment(it.date).format('YYYY-MM-DD')} {it.country}</p>\r\n          ))\r\n        )\r\n      },\r\n      {\r\n        title: '评分',\r\n        dataIndex: 'rate',\r\n        key: 'rate'\r\n      },\r\n      {\r\n        title: '更新时间',\r\n        dataIndex: 'meta',\r\n        key: 'meta',\r\n        render: (text, record) => (<span>{moment(record.meta.createdAt).fromNow(true)} 前</span>)\r\n      },\r\n      {\r\n        title: '豆瓣 ID',\r\n        dataIndex: 'doubanId',\r\n        key: 'doubanId'\r\n      },\r\n      {\r\n        title: '类型',\r\n        dataIndex: 'movieTypes',\r\n        key: 'movieTypes',\r\n        render: (text, record) => (\r\n          record.movieTypes.map((it, i) => (\r\n            <p key={i}>{it}</p>\r\n          ))\r\n        )\r\n      },\r\n      {\r\n        title: '标签',\r\n        dataIndex: 'tags',\r\n        key: 'tags',\r\n        render: (text, record) => (\r\n          record.tags.map((it, i) => (\r\n            <p key={i}>{it}</p>\r\n          ))\r\n        )\r\n      },\r\n      {\r\n        title: '简要',\r\n        key: 'summary',\r\n        render: (text, record) => <p style={{padding: '5px', maxWidth: '800px'}}>{record.summary}</p>\r\n      },\r\n      {\r\n        title: '详情',\r\n        key: '_id',\r\n        render: (text, record) => <a href={`/detail/${record._id}`} target={'_blank'}>详情</a>\r\n      },\r\n      {\r\n        title: '操作',\r\n        key: 'action',\r\n        render: (text, record) => <Button type=\"danger\" onClick={()=>this._deleteMovie(record._id)}>删除</Button>\r\n      }]\r\n    }\r\n  }\r\n\r\n  componentDidMount () {\r\n    this._getAllMovies()\r\n  }\r\n\r\n  _delete = () => {\r\n    this.setState({\r\n      collapsed: !this.state.collapsed\r\n    })\r\n  }\r\n  _toggleLoading = (status = false) => {\r\n    this.setState({\r\n      loading: status\r\n    })\r\n}\r\n  _getAllMovies = () => {\r\n    request(this._toggleLoading)({\r\n      method: 'get',\r\n      url: '/admin/movie/list'\r\n    }).then(res => {\r\n      this.setState({\r\n        dataSource: res\r\n      })\r\n    }).catch(err => {\r\n      console.log(err)\r\n      // this.setState({\r\n      //   dataSource: []\r\n      // })\r\n    })\r\n  }\r\n  _deleteMovie = (id) => {\r\n    request(this._toggleLoading)({\r\n      method: 'delete',\r\n      url: `/admin/movie?id=${id}`\r\n    }).then(res => {\r\n      this.setState({\r\n        dataSource: this.state.dataSource.filter(item=>item._id!=id)\r\n      },()=>{\r\n        message.success('删除成功')\r\n      })\r\n    }).catch(() => {\r\n    })\r\n  }\r\n\r\n  render () {\r\n    let { dataSource, columns } = this.state\r\n\r\n    if (!dataSource || !dataSource.length) return null\r\n\r\n    dataSource = dataSource.map((data, i) => {\r\n      data.key = i\r\n\r\n      return data\r\n    })\r\n\r\n    return (\r\n      <Layout {...this.props}>\r\n        <div className='flex-row full'>\r\n          <div className='flex-1 scroll-y align-self-start'>\r\n            <Table dataSource={dataSource} columns={columns} />\r\n          </div>\r\n        </div>\r\n      </Layout>\r\n    )\r\n  }\r\n}\r\n"]}